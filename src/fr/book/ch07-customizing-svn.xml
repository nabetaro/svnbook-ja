<chapter id="svn.customization">
  <title>Personnalisation de Subversion</title>

  <para>La gestion de versions est un sujet complexe, au moins autant
    un art qu'une science, qui offre une myriade de façons d'accomplir
    chaque tâche. En lisant ce livre, vous avez expérimenté les
    sous-commandes Subversion en ligne de commande et les options pour
    modifier leur comportement. Dans ce chapitre, nous passons
    en revue les moyens de personnaliser le fonctionnement
    de Subversion&nbsp;: la configuration des options d'exécution,
    l'utilisation d'applications externes pour faciliter certains
    traitements, les interactions de Subversion avec la configuration
    des paramètres régionaux du système d'exploitation,&nbsp;etc.</para>

  <!-- TODO(cmpilato): Gut the runtime config stuff like I did the
       property stuff, making larger topical sections to which the
       runtime config stuff generally refers.  Like already exists for
       external diff/diff3, add, for example, a section on external
       editors. -->

  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <sect1 id="svn.advanced.confarea">
    <title>Zone de configuration des exécutables</title>

    <para>Subversion permet à l'utilisateur de contrôler finement son
      comportement. Beaucoup d'options ont vocation à s'appliquer à
      l'ensemble des opérations de Subversion. Ainsi, plutôt que de
      forcer les utilisateurs à se souvenir d'arguments en ligne de
      commande pour spécifier ces options et de les utiliser à chaque
      invocation, Subversion utilise des fichiers de configuration,
      tenus à l'écart dans une zone de configuration spécifique à
      Subversion.</para>

    <para>La <firstterm>zone de configuration</firstterm> Subversion
      consiste en une hiérarchie à deux niveaux constituée de noms
      d'options et de leurs valeurs. Habituellement, cela se traduit
      par un répertoire dédié qui contient les
      <firstterm>fichiers de configuration</firstterm> (le premier
      niveau)&nbsp;: des fichiers texte au format standard INI
      (dont les <quote>sections</quote> constituent le deuxième
      niveau). Vous pouvez facilement éditer ces fichiers à l'aide de
      votre éditeur de texte favori (tel qu'Emacs ou vi). Ils
      contiennent des directives lues par le client Subversion afin de
      déterminer le comportement par défaut choisi par
      l'utilisateur.</para>

    <!-- =============================================================== -->
    <sect2 id="svn.advanced.confarea.layout">
      <title>Agencement de la zone de configuration</title>

      <para>La première fois que le client <command>svn</command> en
        ligne de commande est exécuté, il crée une zone de
        configuration propre à l'utilisateur. Sur les systèmes de type
        Unix, cette zone est un répertoire nommé
        <filename>.subversion</filename> dans le répertoire personnel
        de l'utilisateur. Sur les systèmes Windows, Subversion crée un
        dossier nommé <filename>Subversion</filename>, généralement
        dans la zone <filename>Application Data</filename> du
        répertoire qui contient le profil de l'utilisateur (qui est
        habituellement, au passage, un répertoire caché). Cependant,
        sur cette plate-forme, l'emplacement exact du profil
        utilisateur varie d'un système à l'autre et est dicté par la
        base de registre Windows
        <footnote>
          <para>La variable d'environnement <literal>APPDATA</literal>
            pointe vers la zone <filename>Application Data</filename>,
            vous pouvez donc toujours faire référence à ce dossier en
            utilisant <filename>%APPDATA%\Subversion</filename>.</para>
        </footnote>.
        Nous nous référerons à cette zone de configuration propre à
        l'utilisateur en utilisant son nom Unix&nbsp;:
        <filename>.subversion</filename>.</para>

      <para>En plus de la zone de configuration propre à l'utilisateur,
        Subversion reconnaît l'existence d'une zone de configuration
        globale pour le système. Cela permet aux administrateurs du
        système d'établir une configuration par défaut pour l'ensemble
        des utilisateurs d'une machine donnée. Notez que la zone de
        configuration globale seule ne fixe pas de politique
        définitive&nbsp;: les réglages de l'utilisateur sont
        prioritaires par rapport aux réglages globaux et les options
        de la ligne de commande ont toujours le dernier mot. Sur les
        plate-formes de type Unix, la zone de configuration globale
        doit se trouver dans le répertoire
        <filename>/etc/subversion</filename>&nbsp;; sur les machines
        Windows, Subversion cherche un répertoire
        <filename>Subversion</filename> dans le dossier commun
        <filename>Application Data</filename> (là encore, l'endroit
        exact dépend de la base de registre Windows). Au contraire de
        la zone propre à l'utilisateur, le programme
        <command>svn</command> ne tente pas de créer la zone de
        configuration globale.</para>

      <para>La zone de configuration propre à l'utilisateur contient
        actuellement trois fichiers&nbsp;: deux fichiers de
        configuration (<filename>config</filename> et
        <filename>servers</filename>) et un fichier
        <filename>README.txt</filename> qui décrit le format INI. Lors
        de leur création, ces fichiers contiennent les valeurs par
        défaut de toutes les options supportées par Subversion,
        généralement mises en commentaire et groupées avec une
        description textuelle de l'effet de la clé sur le
        fonctionnement de Subversion. Pour modifier un comportement
        précis, il suffit de charger le fichier de configuration dans
        un éditeur de texte et de changer la valeur de l'option
        correspondante. Si, par la suite, vous voulez rétablir les
        valeurs par défaut, vous n'avez qu'à supprimer ou renommer
        votre répertoire de configuration puis lancer une commande
        <command>svn</command> inoffensive, telle que
        <userinput>svn --version</userinput>. Un nouveau répertoire
        de configuration sera créé, qui contiendra les valeurs par
        défaut.</para>

      <para>La zone de configuration propre à l'utilisateur contient
        également un cache pour les données d'authentification. Le
        répertoire <filename>auth</filename> héberge un ensemble de
        sous-répertoires qui contiennent des informations mises en
        cache, relatives aux différentes méthodes d'authentification
        utilisées par Subversion. Ce répertoire est créé de telle
        manière que seul l'utilisateur ait accès à son contenu.</para>

    </sect2>

    <!-- =============================================================== -->
    <sect2 id="svn.advanced.confarea.windows-registry">
      <title>Configuration via la base de registre Windows</title>

      <para>En plus de la zone de configuration classique contenant
        les fichiers INI, les clients Subversion qui tournent sur une
        plate-forme Windows peuvent aussi utiliser la base de registre
        Windows pour stocker leurs données de configuration. Les noms
        des options et leurs valeurs sont les mêmes que dans les
        fichiers INI. La hiérarchie <quote>fichier/section</quote> est
        également présente, bien que traitée de manière légèrement
        différente&nbsp;: dans ce cas, les fichiers et les sections
        sont juste des niveaux dans l'arborescence des clés de
        registres.</para>

      <para>Subversion cherche les valeurs de configuration
        applicables à tout le système sous la clé
        <literal>HKEY_LOCAL_MACHINE\Software\Tigris.org\Subversion</literal>.
        Par exemple, l'option <literal>global-ignores</literal>, qui
        se trouve dans la section <literal>miscellany</literal> du
        fichier de configuration, est située dans
        <literal>HKEY_LOCAL_MACHINE\Software\Tigris.org\Subversion\Config\Miscellany\global-ignores</literal>.
        Les valeurs propres à un utilisateur doivent être stockées sous
        <literal>HKEY_CURRENT_USER\Software\Tigris.org\Subversion</literal>.
        </para>

      <para>Les options de configuration de la base de registre sont
        analysées <emphasis>avant</emphasis> les options des fichiers
        INI&nbsp;; elles sont donc supplantées par les valeurs trouvées
        dans les fichiers de configuration. En d'autres termes,
        Subversion cherche les options de configuration dans l'ordre
        suivant sur un système Windows (les plus prioritaires sont
        citées en premier)&nbsp;:</para>

      <orderedlist>
        <listitem>
          <para>les options en ligne de commande&nbsp;;</para>
        </listitem>
        <listitem>
          <para>les fichiers INI propres à l'utilisateur&nbsp;;</para>
        </listitem>
        <listitem>
          <para>les valeurs de la base de registre propres
            à l'utilisateur&nbsp;;</para>
        </listitem>
        <listitem>
          <para>les fichiers INI applicables à l'ensemble
            du système&nbsp;;</para>
        </listitem>
        <listitem>
          <para>les valeurs de la base de registre applicables
            à l'ensemble du système.</para>
        </listitem>
      </orderedlist>

      <para>Par ailleurs, la base de registre Windows ne supporte pas
        vraiment la notion de <quote>mise en commentaire</quote>.
        Cependant, Subversion ignorera toute clé dont le nom commence
        par le caractère dièse (<literal>#</literal>). Cela vous
        permet de mettre en commentaire efficacement une option
        Subversion sans avoir à effacer entièrement la clé de la base
        de registre, ce qui simplifie manifestement la procédure de
        restauration de l'option.</para>

      <para>Le client en ligne de commande <command>svn</command>
        n'écrit jamais dans la base de registre et ne tentera pas d'y
        créer une zone de configuration par défaut. Vous pouvez créer
        les clés dont vous avez besoin en utilisant le programme
        <command>REGEDIT</command>. Une autre alternative consiste à
        créer un fichier <filename>.reg</filename> (tel que celui
        donné dans l'<xref
        linkend="svn.advanced.confarea.windows-registry.ex-1" />)
        puis à double-cliquer sur l'icône de ce fichier dans
        l'explorateur Windows afin d'appliquer les modifications
        à votre base de registre.</para>

      <example id="svn.advanced.confarea.windows-registry.ex-1">
        <title>Exemple de fichier de modification de la base
          de registre (.reg)</title>

        <programlisting>
REGEDIT4

[HKEY_LOCAL_MACHINE\Software\Tigris.org\Subversion\Servers\groups]

[HKEY_LOCAL_MACHINE\Software\Tigris.org\Subversion\Servers\global]
"#http-proxy-host"=""
"#http-proxy-port"=""
"#http-proxy-username"=""
"#http-proxy-password"=""
"#http-proxy-exceptions"=""
"#http-timeout"="0"
"#http-compression"="yes"
"#neon-debug-mask"=""
"#ssl-authority-files"=""
"#ssl-trust-default-ca"=""
"#ssl-client-cert-file"=""
"#ssl-client-cert-password"=""

[HKEY_CURRENT_USER\Software\Tigris.org\Subversion\Config\auth]
"#store-passwords"="yes"
"#store-auth-creds"="yes"

[HKEY_CURRENT_USER\Software\Tigris.org\Subversion\Config\helpers]
"#editor-cmd"="notepad"
"#diff-cmd"=""
"#diff3-cmd"=""
"#diff3-has-program-arg"=""

[HKEY_CURRENT_USER\Software\Tigris.org\Subversion\Config\tunnels]

[HKEY_CURRENT_USER\Software\Tigris.org\Subversion\Config\miscellany]
"#global-ignores"="*.o *.lo *.la #*# .*.rej *.rej .*~ *~ .#* .DS_Store"
"#log-encoding"=""
"#use-commit-times"=""
"#no-unlock"=""
"#enable-auto-props"=""

[HKEY_CURRENT_USER\Software\Tigris.org\Subversion\Config\auto-props]
</programlisting>
      </example>

      <para>L'exemple précédent présente le contenu d'un fichier
        <filename>.reg</filename> qui contient quelques unes des
        options les plus communément utilisées et leurs valeurs
        par défaut. Notez la présence de réglages propres à
        l'utilisateur (notamment l'éditeur de texte et le stockage
        des mots de passe) ainsi que de réglages applicables à
        l'ensemble du système (comme les options relatives au
        mandataire réseau). Notez également que toutes les options
        sont mises en commentaire. Il ne vous reste qu'à supprimer
        le caractère dièse (<literal>#</literal>) initial des noms
        d'options et à leur affecter la valeur que vous
        souhaitez.</para>

    </sect2>

    <!-- =============================================================== -->
    <sect2 id="svn.advanced.confarea.opts">
      <title>Options de configuration</title>

      <!-- TODO(cmpilato): Rework and move this section to the Reference -->

      <para>Dans cette section, nous allons nous intéresser aux
        options de configuration des programmes supportées par la
        version actuelle de Subversion.</para>

      <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
      <sect3 id="svn.advanced.confarea.opts.servers">
        <title>Fichier <filename>servers</filename></title>

        <para>Le fichier <filename>servers</filename> contient les
          options de configuration relatives aux couches réseau. Il
          y a deux sections spéciales dans ce fichier&nbsp;:
          <literal>groups</literal> et <literal>global</literal>.
          La section <literal>groups</literal> n'est rien d'autre
          qu'un tableau de références croisées. Les clés de cette
          section sont les noms des autres sections du fichier&nbsp;;
          ses valeurs sont des <firstterm>globs</firstterm> (des
          représentations textuelles qui peuvent contenir des
          caractères joker) qui sont comparés aux noms des machines
          auxquelles des requêtes Subversion sont envoyées.</para>

        <programlisting>
[groups]
serveurs-red-beans = *.red-bean.com
collabnet = svn.collab.net

[serveurs-red-beans]
&hellip;

[collabnet]
&hellip;
</programlisting>

        <para>Quand vous utilisez Subversion en réseau, il essaie de
          faire correspondre le nom du serveur auquel il tente de se
          connecter avec un nom de groupe de la section
          <literal>groups</literal>. Si une correspondance existe,
          Subversion vérifie alors s'il existe dans le fichier
          <filename>servers</filename> une section dont le nom est
          le nom du groupe correspondant. Le cas échéant, il tire
          de cette section la configuration réseau à appliquer.</para>

        <para>La section <literal>global</literal> contient la
          configuration à appliquer à tous les serveurs qui ne
          correspondent à aucun glob de la section
          <literal>groups</literal>. Les options disponibles dans
          cette section sont exactement les mêmes que pour les autres
          sections du fichier (exceptée bien sûr la section spéciale
          <literal>groups</literal>) et sont&nbsp;:</para>

        <variablelist>
          <varlistentry>
            <term><literal>http-proxy-exceptions</literal></term>
            <listitem>
              <para>Cette option contient une liste de motifs
                (séparés par des virgules) de noms de machines
                qui doivent être contactées directement, sans passer
                par le mandataire. La syntaxe des motifs est la même
                que celle utilisée par le shell Unix pour les noms de
                fichiers. L'accès aux dépôts d'une machine dont le nom
                correspond à l'un de ces motifs se fera sans passer
                par un mandataire.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>http-proxy-host</literal></term>
            <listitem>
              <para>Cette option contient le nom de la machine
                mandataire pour les requêtes HTTP de Subversion. La
                valeur par défaut est vide, ce qui signifie que
                Subversion ne tentera pas de faire passer ses requêtes
                par un mandataire mais essaiera de contacter la machine
                de destination directement.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>http-proxy-port</literal></term>
            <listitem>
              <para>Cette option contient le numéro du port à
                utiliser sur la machine mandataire. Par défaut,
                la valeur est vide.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>http-proxy-username</literal></term>
            <listitem>
              <para>Cette option contient le nom d'utilisateur à
                fournir à la machine mandataire. Par défaut, la valeur
                est vide.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>http-proxy-password</literal></term>
            <listitem>
              <para>cette option contient le mot de passe à fournir à
                la machine mandataire. Par défaut, la valeur est
                vide.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>http-timeout</literal></term>
            <listitem>
              <para>Cette option contient la durée maximum, en
                secondes, pendant laquelle Subversion attend la
                réponse du serveur. Si vous rencontrez des problèmes
                d'opérations Subversion qui expirent à cause d'une
                connexion réseau trop lente, vous devez augmenter
                cette valeur. Par défaut, la valeur est
                <literal>0</literal>, ce qui conduit la bibliothèque
                HTTP sous-jacente (Neon) à utiliser sa propre valeur
                par défaut.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>http-compression</literal></term>
            <listitem>
              <para>Cette option indique si oui ou non Subversion
                doit essayer de compresser les requêtes réseaux à
                destination de serveurs DAV. La valeur par défaut est
                <literal>yes</literal>. Notez que la compression ne
                sera effective que si la couche réseau a été compilée
                avec le support de la compression. Mettez
                <literal>no</literal> pour ne pas activer la
                compression, par exemple lorsque vous analysez les
                transmissions réseaux.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>http-library</literal></term>
            <listitem>
              <para>Subversion est fourni avec deux modules d'accès
                aux dépôts qui utilisent le protocole réseau WebDAV.
                Le module originel, fourni avec Subversion 1.0, est
                <literal>libsvn_ra_neon</literal>
                (bien qu'en ce temps-là, il s'appelait
                <literal>libsvn_ra_dav</literal>). Les nouvelles
                versions de Subversion fournissent également
                <literal>libsvn_ra_serf</literal>, qui utilise une
                implémentation sous-jacente différente et qui vise à
                supporter certains des concepts HTTP les plus
                récents.</para>

              <para>Actuellement, <literal>libsvn_ra_serf</literal>
                est toujours considérée en version expérimentale,
                bien qu'elle semble fonctionner correctement dans les
                cas usuels. Afin d'inciter les gens à l'essayer,
                Subversion fournit l'option de configuration
                <literal>http-library</literal> pour permettre aux
                utilisateurs de définir (globalement ou par groupe de
                serveurs) quel module d'accès WebDAV ils veulent
                utiliser&nbsp;: <literal>neon</literal> ou
                <literal>serf</literal>.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>http-auth-types</literal></term>
            <listitem>
              <para>Cette option liste les méthodes
                d'authentification (séparées par des points-virgules)
                supportées par les module d'accès aux dépôts WebDAV
                basés sur Neon. Les valeurs valides sont&nbsp;:
                <literal>basic</literal>,
                <literal>digest</literal> et
                <literal>negotiate</literal>.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>neon-debug-mask</literal></term>
            <listitem>
              <para>Cette option contient un entier qui représente un
                masque que la bibliothèque HTTP sous-jacente (Neon)
                utilise pour choisir quel type d'affichage de débogage
                autoriser. La valeur par défaut est <literal>0</literal>,
                ce qui interdit tout affichage de débogage. Pour plus
                d'informations sur l'utilisation de Neon par
                Subversion, reportez-vous au <xref
                linkend="svn.developer" />.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>ssl-authority-files</literal></term>
            <listitem>
              <para>Cette option contient une liste de chemins
                (séparés par des points-virgules) vers les fichiers
                contenant les certificats des autorités de
                certifications (AC) qui doivent être reconnues comme
                de confiance par le client Subversion lors des accès
                aux dépôts en HTTPS.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>ssl-trust-default-ca</literal></term>
            <listitem>
              <para>Mettez cette variable à <literal>yes</literal>
                si vous voulez que Subversion fasse automatiquement
                confiance à l'ensemble des autorités de certification
                livrées par défaut avec OpenSSL.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>ssl-client-cert-file</literal></term>
            <listitem>
              <para>Si un hôte (ou un ensemble d'hôtes) demande un
                certificat SSL au client, vous serez sollicité pour
                fournir le chemin de votre certificat. Dès que cette
                variable contient ce chemin, Subversion sera capable
                de trouver automatiquement votre certificat et ne
                vous sollicitera pas. Il n'existe pas d'emplacement
                standard pour stocker un certificat utilisateur sur
                le disque&nbsp;; Subversion va le chercher à l'endroit
                que vous lui spécifiez.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>ssl-client-cert-password</literal></term>
            <listitem>
              <para>Si votre certificat client SSL est protégé par
                une phrase de passe, Subversion vous la demandera
                à chaque fois que le certificat est utilisé. Si vous
                trouvez cela pénible (et que cela ne vous dérange pas
                que cette phrase de passe soit stockée dans le fichier
                <filename>servers</filename>), vous pouvez placer
                dans cette variable la phrase de passe de votre
                certificat. Vous ne serez plus sollicité.</para>
            </listitem>
          </varlistentry>
        </variablelist>

      </sect3>

      <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
      <sect3 id="svn.advanced.confarea.opts.config">
        <title>Fichier <filename>config</filename></title>

        <para>Le fichier <filename>config</filename> contient le reste
          des options du programme Subversion disponibles actuellement,
          c'est-à-dire celles qui ne se rapportent pas au réseau. Au
          moment où ces lignes sont écrites, seules quelques options
          sont utilisées, mais elles sont quand même regroupées en
          sections en prévision d'ajouts futurs.</para>

        <para>La section <literal>auth</literal> contient les
          paramètres relatifs à l'authentification et au contrôle
          d'accès de Subversion pour les dépôts. Elle comprend les
          options suivantes&nbsp;:</para>

        <variablelist>
          <varlistentry>
            <term><literal>store-passwords</literal></term>
            <listitem>
              <para>Cette option demande à Subversion de garder en
                cache (ou non) les mots de passe qui sont tapés par
                l'utilisateur en réponse aux demandes
                d'authentification des serveurs. La valeur par défaut
                est <literal>yes</literal>. Remplacez cette valeur par
                <literal>no</literal> pour désactiver la mise en cache
                sur le disque. Vous pouvez outrepasser cette option
                pour un appel donné d'une commande
                <command>svn</command> en utilisant l'option de ligne
                de commande <option>--no-auth-cache</option> (pour les
                sous-commandes qui acceptent cette option). Pour plus
                d'informations, consultez <xref
                linkend="svn.serverconfig.netmodel.credcache"/>.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>store-auth-creds</literal></term>
            <listitem>
              <para>cette option est équivalente à
                <literal>store-passwords</literal> sauf qu'elle
                applique la mise en cache sur le disque (ou non) à
                <emphasis>l'ensemble</emphasis> des informations
                d'authentification&nbsp;: identifiants, mots de passe,
                certificats serveur et tout autre type d'élément
                pouvant être mis en cache.</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>La section <literal>helpers</literal> définit quelles
          sont les applications externes utilisées par Subversion pour
          accomplir ses tâches. Les options valides dans cette section
          sont&nbsp;:</para>

        <variablelist>
          <varlistentry>
            <term><literal>editor-cmd</literal></term>
            <listitem>
              <para>Cette option indique le programme utilisé par
               l'utilisateur auquel Subversion demande d'entrer des
               méta-données textuelles ou de résoudre les conflits de
               manière interactive. Consultez <xref
               linkend="svn.advanced.externaleditors"/>
               pour plus de détails sur l'utilisation d'un éditeur de
               texte externe avec Subversion.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>diff-cmd</literal></term>
            <listitem>
              <para>Cette option contient le chemin absolu du
                programme de comparaison qui est utilisé lorsque
                Subversion doit afficher à l'utilisateur plusieurs
                fichiers à comparer (par exemple lors de l'utilisation
                de la commande <command>svn diff</command>). Par
                défaut, Subversion utilise une bibliothèque interne de
                comparaison. Définir cette option le forcera à utiliser
                un programme externe pour effectuer cette tâche.
                Consultez <xref linkend="svn.advanced.externaldifftools"/>
                pour plus de détails sur l'utilisation de tels
                programmes.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>diff3-cmd</literal></term>
            <listitem>
              <para>Cette option contient le chemin absolu d'un
                programme de comparaison à trois entrées. Subversion
                utilise ce programme pour fusionner les changements
                effectués par l'utilisateur avec ceux en provenance
                du dépôt. Par défaut, Subversion utilise une
                bibliothèque interne de comparaison. Définir cette
                option le forcera à utiliser un programme externe pour
                effectuer cette tâche. Consultez <xref
                linkend="svn.advanced.externaldifftools"/>
                pour plus de détails sur l'utilisation de tels
                programmes.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>diff3-has-program-arg</literal></term>
            <listitem>
              <para>Ce drapeau doit être mis à <literal>true</literal>
                si le programme spécifié par l'option
                <literal>diff3-cmd</literal> accepte l'option
                <option>--diff-program</option> en ligne de
                commande.</para>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term><literal>merge-tool-cmd</literal></term>
            <listitem>
              <para>Cette option contient le programme que Subversion
                utilise pour effectuer les opérations de fusion à
                trois sources sur vos fichiers suivis en versions.
                Consultez <xref
                linkend="svn.advanced.externaldifftools"/> pour plus
                de détails sur l'utilisation de tels
                programmes.</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>La section <literal>tunnels</literal> vous permet de
          définir de nouveaux tunnels à utiliser avec les connexions
          clientes <command>svnserve</command> et
          <literal>svn://</literal>. Pour plus de détails, consultez
          <xref linkend="svn.serverconfig.svnserve.sshauth"/>.</para>

        <para>La section <literal>miscellany</literal> récolte tout
          ce qui n'a pas sa place ailleurs
          <footnote>
            <para>En clair, c'est un joyeux fourre-tout.</para>
          </footnote>
            Dans cette section, vous trouvez&nbsp;:</para>

        <variablelist>
          <varlistentry>
            <term><literal>global-ignores</literal></term>
            <listitem>
              <para>Quand vous exécutez la commande
                <command>svn status</command>, Subversion affiche la
                liste des fichiers et répertoires non suivis en versions
                avec ceux qui sont suivis en versions, en les marquant
                d'un caractère <literal>?</literal> (voir
                <xref linkend="svn.tour.cycle.examine.status"/>).
                Parfois, ces éléments inutiles et non suivis en version
                ne font que rendre l'affichage plus confus, par exemple
                dans le cas des fichiers objets générés par les
                compilations. L'option <option>global-ignores</option>
                contient une liste de globs séparés par des espaces
                qui décrivent les noms de fichiers et de répertoires
                que Subversion ne doit pas afficher, sauf s'ils sont
                suivis en versions. La valeur par défaut est
                <literal>*.o *.lo *.la #*# .*.rej
                *.rej .*~ *~ .#* .DS_Store</literal>.</para>

              <para>Tout comme <command>svn status</command>, les
                commandes <command>svn add</command> et <command>svn
                import</command> ignorent les fichiers qui entrent en
                correspondance avec la liste lors du parcours d'un
                répertoire. Vous pouvez bloquer ce comportement pour
                une instance donnée de ces commandes en spécifiant
                explicitement le nom de fichier ou en utilisant
                l'option <option>--no-ignore</option> en ligne de
                commande.</para>

              <para>Vous pouvez trouvez des informations pour contrôler
                plus finement les éléments ignorés dans <xref
                linkend="svn.advanced.props.special.ignore" />.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>enable-auto-props</literal></term>
            <listitem>
              <para>Cette option demande à Subversion d'ajouter
                automatiquement des propriétés sur les fichiers
                nouvellement ajoutés ou importés. La valeur par défaut
                est <literal>no</literal>, vous devez donc lui
                affecter la valeur <literal>yes</literal> pour
                activer cette fonctionnalité. La section
                <literal>auto-props</literal> de ce fichier
                spécifie quelles propriétés doivent être définies
                sur quels fichiers.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>log-encoding</literal></term>
            <listitem>
              <para>Cette option définit la valeur par défaut du
                codage des caractères des messages de propagation.
                C'est le pendant permanent de l'option
                <option>--encoding</option> (voir
                <xref linkend="svn.ref.svn.sw"/>). Le dépôt
                Subversion stocke les messages de propagation en
                UTF-8 et suppose que votre message est écrit en
                utilisant le codage défini par votre système
                d'exploitation. Vous devez spécifier un codage
                différent si vos messages de propagation sont rédigés
                avec un autre codage.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>use-commit-times</literal></term>
            <listitem>
              <para>Normalement, les fichiers de votre copie de
                travail sont datés de manière à indiquer la dernière
                fois qu'ils ont été manipulés par n'importe quel
                processus, que ce soit votre éditeur de texte ou une
                sous-commande <command>svn</command>. C'est le
                comportement attendu généralement par les développeurs
                de logiciels, puisque les systèmes de compilation
                examinent souvent ces dates pour décider quels
                fichiers doivent être recompilés.</para>

              <para>Dans d'autres situations, cependant, il est
                préférable d'avoir une date qui indique la dernière
                fois que le fichier a été modifié dans le dépôt. La
                commande <command>svn export</command> marque
                <quote>la date de la dernière propagation</quote>
                sur les arborescences qu'elle produit. En mettant
                cette variable de configuration à
                <literal>yes</literal>, les commandes
                <command>svn checkout</command>,
                <command>svn update</command>,
                <command>svn switch</command> et
                <command>svn revert</command> marqueront également
                les fichiers qu'elles modifient avec la date de
                dernière propagation.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>mime-types-file</literal></term>
            <listitem>
              <para>Cette option est apparue dans Subversion 1.5.
                Elle spécifie le chemin d'un fichier de
                correspondance pour les types MIME, de la même manière
                que le fichier <filename>mime.types</filename> fourni
                par le serveur HTTP Apache. Subversion utilise ce
                fichier pour associer des types MIME aux nouveaux
                fichiers ajoutés ou importés. Consultez
                <xref linkend="svn.advanced.props.auto" /> et
                <xref linkend="svn.advanced.props.special.mime-type"/>
                pour plus d'informations sur la détection et
                l'utilisation des types de fichiers par
                Subversion.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>preserved-conflict-file-exts</literal></term>
            <listitem>
              <para>La valeur de cette option est une liste
                d'extensions de fichiers (séparées par des espaces)
                que Subversion doit préserver quand il génère des noms
                de fichiers lors des conflits. Par défaut, cette liste
                est vide. C'est une nouvelle option apparue dans
                Subversion 1.5.</para>

              <para>Quand Subversion détecte des conflits dans les
                modifications effectuées sur un fichier, il soumet la
                résolution de ces conflits à l'utilisateur. Pour aider
                l'utilisateur à les résoudre, Subversion garde une
                copie originale des différentes versions en lice du
                fichier dans la copie de travail. Par défaut, ces
                fichiers ont des noms construits en ajoutant au nom de
                fichier original une extension particulière telle que
                <filename>.mine</filename> ou <filename>.REV</filename>
                (où <replaceable>REV</replaceable> est un numéro de
                révision). Ceci peut être gênant sur les systèmes
                d'exploitation qui utilisent les extensions de noms
                de fichiers pour déterminer l'application par défaut
                à utiliser pour ouvrir et éditer le fichier, le fichier
                avec la nouvelle extension n'étant plus automatiquement
                ouvert dans l'application prévue. Par exemple, si le
                fichier <filename>NotesDeVersion.pdf</filename> est en
                conflit, les fichiers générés risquent de s'appeler
                <filename>NotesDeVersion.pdf.mine</filename> ou
                <filename>NotesDeVersion.pdf.r4231</filename>. Bien
                que votre système soit peut-être configuré pour ouvrir
                les fichiers <filename>.pdf</filename> ave Acrobat
                Reader, il n'existe sûrement pas d'application
                préconfigurée pour ouvrir les fichiers avec
                l'extension <filename>.r4231</filename>.</para>

              <para>Vous pouvez arranger cela en utilisant cette
                option de configuration. Pour les fichiers dont
                l'extension est spécifiée, Subversion ajoutera au
                nom des fichiers générés l'extension particulière
                liée au conflit, mais il rajoutera aussi à la suite
                l'extension originale. Dans l'exemple précédent,
                en supposant que <literal>pdf</literal> est une des
                extensions configurée dans la liste ci-dessus, les
                noms des fichiers générés pour
                <filename>NotesDeVersion.pdf</filename> vont être
                <filename>NotesDeVersion.pdf.mine.pdf</filename> et
                <filename>NotesDeVersion.pdf.r4231.pdf</filename>.
                Comme chaque fichier se termine par
                <filename>.pdf</filename>, l'application appropriée
                sera utilisée pour les visualiser.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>interactive-conflicts</literal></term>
            <listitem>
              <para>Cette option est une option booléenne qui indique
                si Subversion doit essayer de résoudre les conflits de
                manière interactive. Si la valeur est
                <literal>yes</literal> (qui est la valeur par défaut),
                Subversion demandera à l'utilisateur comment gérer les
                conflits, comme indiqué dans
                <xref linkend="svn.tour.cycle.resolve"/>.
                Autrement, il marquera simplement qu'il existe un
                conflit et continuera l'opération en cours, remettant
                sa résolution à plus tard.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><literal>no-unlock</literal></term>
            <listitem>
              <para>Cette option booléenne correspond à l'option
                <option>--no-unlock</option> de
                <command>svn commit</command>. Elle indique à
                Subversion de ne pas libérer les verrous posés sur
                les fichiers que vous venez de propager. Si cette
                option est positionnée à <literal>yes</literal>,
                Subversion ne libérera jamais aucun verrou
                automatiquement, vous laissant le faire explicitement
                avec <command>svn unlock</command>. La valeur par
                défaut est <literal>no</literal>.</para>
            </listitem>
          </varlistentry>

        </variablelist>

        <para>La section <literal>auto-props</literal> contrôle la
          possibilité par le client Subversion de positionner
          automatiquement certaines propriétés sur les fichiers qui
          sont ajoutés ou importés. Elle contient un nombre arbitraire
          de paires clé-valeur au format <literal>MOTIF =
          NOM_PROPRIETE=VALEUR[;NOM_PROPRIETE=VALEUR ...]</literal>,
          où <literal>MOTIF</literal> est un motif de nom de fichier
          qui correspond à un ou plusieurs noms de fichiers et le
          reste de la ligne est une liste d'affectations (séparées
          par des points-virgules) de valeurs à des propriétés. Si
          un nom de fichier correspond à plusieurs motifs, autant de
          propriétés seront positionnées&nbsp;; cependant, il n'y a
          aucune garantie que les auto-props seront appliquées dans
          l'ordre dans lequel elles apparaissent dans le fichier
          <filename>config</filename>&nbsp;; il ne faut donc pas
          définir de règles susceptibles d'en écraser d'autres. Vous
          pouvez trouver de nombreux exemples d'utilisation
          d'auto-props dans le fichier <filename>config</filename>.
          Enfin, n'oubliez pas de positionner
          <literal>enable-auto-props</literal> à <literal>yes</literal>
          dans la section <literal>miscellany</literal> si vous voulez
          activer auto-props.</para>

      </sect3>

    </sect2>
  </sect1>

  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <sect1 id="svn.advanced.l10n">
    <title>Localisation</title>

    <para>La <firstterm>localisation</firstterm> (aussi appelée
      <firstterm>régionalisation</firstterm>) consiste à modifier le
      comportement d'un programme pour qu'il agisse d'une manière
      propre à une région. Quand un programme formate les nombres et
      les dates d'une façon particulière pour votre région du monde
      ou quand il affiche des messages (ou accepte des entrées) dans
      votre langue maternelle, le programme est dit
      <firstterm>localisé</firstterm>. Cette section décrit les étapes
      qu'a franchi Subversion pour être localisable.</para>

    <!-- =============================================================== -->
    <sect2 id="svn.advanced.l10n.understanding">
      <title>Généralités sur la localisation</title>

      <para>La plupart des systèmes d'exploitation modernes intègrent
        la notion de <quote>paramètres régionaux courants</quote>
        (<foreignphrase>current locale</foreignphrase> en anglais),
        c'est-à-dire la région ou le pays dont les conventions sont
        appliquées. Ces conventions, généralement choisies par un
        mécanisme de configuration pour la durée du fonctionnement
        d'un programme sur l'ordinateur, affectent la façon dont les
        données sont présentées à l'utilisateur ainsi que la façon
        dont les entrées de l'utilisateur sont traitées.</para>

      <para>Sur la majorité des systèmes de type Unix, vous pouvez
        vérifier la valeur des paramètres régionaux en cours en
        lançant la commande <command>locale</command>&nbsp;:</para>

      <screen>
$ locale
LANG=
LC_COLLATE="C"
LC_CTYPE="C"
LC_MESSAGES="C"
LC_MONETARY="C"
LC_NUMERIC="C"
LC_TIME="C"
LC_ALL="C"
$
</screen>

      <para>L'affichage comprend une liste de variables
        d'environnement relatives à des conventions locales et leur
        valeurs. Dans cet exemple, toutes les variables possèdent la
        valeur par défaut <literal>C</literal>, mais les utilisateurs
        peuvent modifier ces valeurs et leur affecter des valeurs
        propres à leur pays ou à leur langue. Par exemple, si
        quelqu'un fixe la valeur de la variable
        <literal>LC_TIME</literal> à <literal>fr_CA</literal>, les
        programmes sauront qu'il doivent afficher les dates et les
        heures conformément aux attentes des canadiens francophones.
        Et si quelqu'un fixe la valeur de la variable
        <literal>LC_MESSAGES</literal> à <literal>zh_TW</literal>,
        les programmes sauront qu'il doivent afficher les messages à
        destination de l'utilisateur en chinois traditionnel. Modifier
        la variable <literal>LC_ALL</literal> équivaut à donner à
        toutes les variables de paramètres régionaux la valeur choisie
        pour <literal>LC_ALL</literal>. La valeur de la variable
        <literal>LANG</literal> est utilisée par défaut pour toute
        variable de paramètre régional qui n'a pas de valeur
        attribuée. Pour voir la liste de toutes les variables de
        paramètres régionaux sur un système Unix, lancez la commande
        <userinput>locale -a</userinput>.</para>

      <para>Sous Windows, la configuration des paramètres régionaux
        s'effectue par l'intermédiaire de l'élément
        <quote>Options régionales, date, heure et langue</quote> du
        panneau de configuration. Vous pouvez y voir et y sélectionner
        les valeurs de chacune des variables disponibles, voire
        personnaliser les conventions d'affichage de nombreux
        paramètres (à un niveau de détail presque maladif).</para>

    </sect2>

    <!-- =============================================================== -->
    <sect2 id="svn.advanced.l10n.svnuse">
      <title>Utilisation des paramètres régionaux par Subversion</title>

      <para>Le client Subversion, <command>svn</command>, utilise la
        configuration courante des paramètres régionaux de deux
        manières. D'abord, il prend en compte la valeur de la
        variable <literal>LC_MESSAGES</literal> et essaie d'afficher
        tous les messages dans la langue indiquée.
        Par exemple&nbsp;:</para>

      <screen>
$ export LC_MESSAGES=de_DE
$ svn help cat
cat: Gibt den Inhalt der angegebenen Dateien oder URLs aus.
Aufruf: cat ZIEL[@REV]...
&hellip;
</screen>

      <para>Ce comportement est identique sur les systèmes Unix et
        Windows. Notez cependant que, bien que votre système
        d'exploitation puisse supporter certaines valeurs de
        paramètres régionaux, Subversion ne parle peut-être pas toutes
        ces langues. Afin d'afficher ces messages localisés, des
        volontaires (humains) doivent fournir des traductions dans
        chaque langue. Les traductions sont écrites en utilisant le
        paquetage GNU gettext, ce qui produit des modules de
        traduction dont l'extension du nom de fichier est
        <filename>.mo</filename>. Par exemple, le fichier des
        traductions allemandes s'appelle <filename>de.mo</filename>.
        Ces fichiers de traductions sont installés quelque part sur
        votre système. Sous Unix, ils sont généralement placés dans
        <filename>/usr/share/locale/</filename>, alors que sous Windows
        on les trouve souvent dans le dossier
        <filename>\share\locale\</filename> de la zone d'installation
        de Subversion. Une fois installé, un module est renommé
        d'après le programme pour lequel il fournit des traductions.
        Par exemple, le fichier <filename>de.mo</filename> sera
        peut-être finalement installé en tant que
        <filename>/usr/share/locale/de/LC_MESSAGES/subversion.mo</filename>.
        En parcourant les fichiers <filename>.mo</filename> installés,
        vous pouvez voir quelles langues le client Subversion
        parle.</para>

      <para>La prise en compte des paramètres régionaux se fait aussi
        au niveau de la façon dont <command>svn</command> interprète
        vos entrées. Le dépôt stocke tous les chemins, noms de
        fichiers et messages de propagation en Unicode, plus
        exactement en UTF-8. En ce sens, le dépôt est
        <firstterm>internationalé</firstterm>, c'est-à-dire que le
        dépôt peut accepter des entrées en n'importe quelle langue.
        Cela signifie cependant que le client Subversion ne doit
        envoyer vers le dépôt que des noms de fichiers et des messages
        de propagation en UTF-8. Pour ce faire, il doit convertir les
        données depuis les paramètres régionaux courants vers
        l'UTF-8.</para>

      <para>Par exemple, supposons que vous créez un fichier nommé
        <filename>caffè.txt</filename> et qu'ensuite, lorsque vous
        propagez ce fichier, vous fournissez le message de
        propagation suivant&nbsp;:
        <quote>Adesso il caffè è più forte</quote>. Le nom du fichier
        et le message de propagation contiennent tous deux des
        caractères non-ASCII, mais puisque vos paramètres régionaux
        sont <literal>it_IT</literal>, le client Subversion sait qu'il
        doit les interpréter comme de l'italien. Il utilise alors un
        jeu de caractères italiens pour convertir ces données en UTF-8
        avant de les envoyer au dépôt.</para>

      <para>Remarquez que bien que le dépôt exige des noms de fichiers
        et des messages de propagation au format UTF-8, il
        <emphasis>ne s'intéresse pas</emphasis> au contenu du fichier.
        Subversion traite le contenu des fichiers comme des chaînes
        d'octets <quote>opaques</quote>&nbsp;; ni le client ni le serveur
        ne tentent de comprendre le jeu de caractères ou le codage du
        contenu d'un fichier.</para>

      <sidebar>
        <title>Erreurs de conversion des jeux de caractères</title>

        <para>Lors de l'utilisation de Subversion, vous êtes
          susceptible d'être confronté à des erreurs de conversion
          des jeux de caractères&nbsp;:</para>

        <screen>
svn: Impossible de convertir la chaîne de l'encodage natif vers 'UTF-8' :
&hellip;
svn: Impossible de convertir la chaîne de 'UTF-8' vers l'encodage natif :
&hellip;
</screen>

        <para>De telles erreurs surviennent généralement quand un
          client Subversion reçoit une chaîne UTF-8 du dépôt et que
          certains caractères de cette chaîne ne peuvent pas être
          représentés dans le jeu de caractères local. Par exemple,
          si vos paramètres régionaux sont <literal>en_US</literal>
          et qu'un collaborateur a propagé un nom de fichier en
          japonais, alors il y a de grandes chances que cette erreur
          apparaisse lors de la réception du fichier pendant
          l'exécution de <command>svn update</command>.</para>

        <para>La solution consiste soit à configurer vos paramètres
          régionaux de manière à <emphasis>pouvoir</emphasis> traiter
          n'importe quelles données au format UTF-8, soit à modifier le
          nom de fichier ou le message de propagation dans le dépôt
          (et n'oubliez pas de taper sur les doigts de votre
          collaborateur&nbsp;: les projets doivent décider en amont
          des langues à utiliser, de manière à ce que l'ensemble des
          collaborateurs utilisent les mêmes paramètres régionaux).</para>

      </sidebar>

    </sect2>

  </sect1>

  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <sect1 id="svn.advanced.externaleditors">
    <title>Utilisation d'éditeurs externes</title>

    <para>La manière la plus évidente d'entrer des données dans
      Subversion consiste à ajouter des fichiers sous gestion de
      versions, propager des changements sur ces fichiers,&nbsp;etc.
      Mais d'autres informations existent dans le dépôt Subversion à
      côté des données constituées par les simples fichiers suivis
      en versions. Certaines de ces informations — les messages de
      propagation, les commentaires sur les verrous et les valeurs de
      certaines propriétés — ont naturellement tendance à être
      textuelles et sont explicitement fournies par les utilisateurs.
      La plupart de ces informations peuvent être fournies à Subversion
      à l'aide du client en ligne de commande en utilisant les options
      <option>--message</option> (<option>-m</option>) et
      <option>--file</option> (<option>-F</option>) dans le cadre des
      sous-commandes appropriées.</para>

    <para>Chacune de ces options a des avantages et des inconvénients.
      Par exemple, quand vous effectuez une propagation, l'option
      <option>--file</option> (<option>-F</option>) fonctionne bien
      si vous avez déjà préparé un fichier texte qui contient votre
      message de propagation. Si vous ne l'avez pas fait, vous pouvez
      toujours utiliser l'option <option>--message</option>
      (<option>-m</option>) pour stipuler votre message en ligne de
      commande. Malheureusement, composer un message de plus d'une
      ligne en ligne de commande peut être assez délicat. Les
      utilisateurs veulent plus de flexibilité&nbsp;: ils veulent
      pouvoir écrire un message de propagation multi-ligne, sans
      contrainte de format et à la demande.</para>

    <para>Subversion répond à cette attente en vous permettant de
      spécifier un éditeur de texte externe qui sera lancé au
      besoin, vous offrant ainsi un moyen plus puissant pour entrer
      des méta-données textuelles. Il y a plusieurs manières
      d'indiquer à Subversion quel éditeur vous voulez utiliser.
      Subversion vérifie les choses suivantes, dans l'ordre spécifié,
      avant de lancer un tel éditeur&nbsp;:</para>

    <orderedlist>
      <listitem>
        <para>l'option en ligne de commande
          <literal>--editor-cmd</literal></para>
      </listitem>
      <listitem>
        <para>la variable d'environnement
          <literal>SVN_EDITOR</literal></para>
      </listitem>
      <listitem>
        <para>l'option de configuration
          <literal>editor-cmd</literal></para>
      </listitem>
      <listitem>
        <para>la variable d'environnement
          <literal>VISUAL</literal></para>
      </listitem>
      <listitem>
        <para>la variable d'environnement
          <literal>EDITOR</literal></para>
      </listitem>
      <listitem>
        <para>éventuellement, une valeur par défaut spécifiée dans
          une des bibliothèques de Subversion (non présente dans les
          distributions officielles)</para>
      </listitem>
    </orderedlist>

    <para>La valeur de n'importe laquelle de ces options ou variables
      est le début de la ligne de commande qui sera exécutée par
      le shell. Subversion ajoute à cette ligne de commande un espace
      et le chemin vers un fichier temporaire à éditer. Ainsi, pour
      être utilisé avec Subversion, l'éditeur spécifié ou configuré
      doit pouvoir être appelé avec pour dernier argument de sa
      ligne de commande le fichier à éditer, il doit être capable
      de sauvegarder le fichier au même endroit et il doit retourner
      zéro comme code de retour, pour indiquer la réussite de
      l'opération.</para>

    <para>Comme indiqué, les éditeurs externes peuvent être utilisés
      pour fournir les messages de propagation à n'importe quelle
      sous-commande de propagation (telle que
      <command>svn commit</command> ou <command>svn import</command>,
      <command>svn mkdir</command> ou <command>svn delete</command>
      quand vous fournissez une URL cible,&nbsp;etc.) et Subversion
      essaie de lancer l'éditeur automatiquement si vous ne
      spécifiez ni l'option <option>--message</option>
      (<option>-m</option>) ni l'option <option>--file</option>
      (<option>-F</option>). La commande
      <command>svn propedit</command> est presque entièrement
      construite autour de l'utilisation d'un éditeur de texte
      externe. À partir de la version 1.5, Subversion utilise
      également l'éditeur de texte externe configuré quand
      l'utilisateur demande le lancement d'un éditeur lors de la
      résolution interactive de conflits. Bizarrement, il ne semble
      pas y avoir de moyen d'utiliser un éditeur externe pour
      fournir un commentaire de verrouillage de manière
      interactive.</para>

  </sect1>

  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <sect1 id="svn.advanced.externaldifftools">
    <title>Utilisation des outils externes de comparaison
      et de fusion</title>

    <para>L'interface entre Subversion et les outils de comparaison
      (de deux ou trois fichiers) remonte à l'époque où Subversion,
      pour afficher les différences de manière contextuelle,
      utilisait directement la suite d'outils GNU de comparaison,
      plus précisément les utilitaires <command>diff</command> et
      <command>diff3</command>. Pour obtenir le comportement désiré
      par Subversion, l'appel à ces programmes se faisait avec une
      ribambelle d'options et de paramètres dont la plupart étaient
      spécifiques à ces utilitaires. Plus tard, Subversion s'est doté
      de sa propre bibliothèque de comparaison et, afin de conserver
      la possibilité de choisir, les options
      <option>--diff-cmd</option> et <option>--diff3-cmd</option>
      ont été ajoutées au client en ligne de commande pour que les
      utilisateurs allergiques à la nouvelle bibliothèque puissent
      indiquer facilement leur souhait de se servir des utilitaires
      GNU diff et diff3. Si ces options étaient utilisées,
      Subversion ignorait purement et simplement
      sa bibliothèque interne de comparaison et appelait
      alors ces programmes externes, avec leurs listes d'arguments
      longue comme un jour sans pain et leurs autres spécificités.
      Les choses sont restées en l'état.</para>

    <para>Il n'a pas fallu longtemps pour que les adeptes de
      Subversion comprennent que si l'on pouvait utiliser les
      utilitaires GNU <command>diff</command> et
      <command>diff3</command> situés à un endroit précis du disque,
      on pouvait alors aussi utiliser ce mécanisme pour utiliser
      d'autres outils de comparaison. Après tout, Subversion ne
      vérifiait pas que les programmes qu'il lançait faisaient bien
      partie de la suite des outils GNU de comparaison. Mais la seule
      chose que l'on peut configurer dans l'utilisation de programmes
      externes est leur emplacement sur le disque&nbsp;; pas les
      options, ni l'ordre des paramètres, ni le reste. Subversion
      continue à envoyer toutes les options des utilitaires GNU à
      votre programme de comparaison, indépendamment du fait que
      votre programme en tienne compte ou non. Et c'est là que la
      plupart des utilisateurs ne comprennent pas la logique de
      la chose.</para>

    <para>La clé pour utiliser des outils externes de comparaison de
      deux ou trois fichiers (autres que les programmes GNU diff et
      diff3 bien sûr) avec Subversion est de créer des scripts
      d'interface qui convertissent les données fournies par
      Subversion en données compréhensibles par l'outil de comparaison
      que vous utilisez, puis de convertir les sorties de votre outil
      vers le format attendu par Subversion&nbsp;: le format que les
      outils GNU auraient utilisé. Les sections suivantes détaillent
      les spécificités de ce qu'attend Subversion.</para>

    <note>
      <para>La décision de lancer une comparaison entre deux ou trois
        fichiers dans le cadre d'une opération Subversion est
        entièrement du ressort de Subversion et est conditionnée,
        en autres, au fait que les fichiers soient lisibles par un
        humain comme indiqué par leur propriété
        <literal>svn:mime-type</literal>. Cela signifie, par exemple,
        que même si vous avez le plus formidable outil de l'univers,
        capable de comparer et fusionner des documents Microsoft Word,
        il ne sera jamais appelé par Subversion tant que le type MIME
        des documents Word suivis en versions indiquera qu'ils ne sont
        pas lisibles par un humain (tel que
        <literal>application/msword</literal>). Pour plus
        d'informations sur la configuration des types MIME, voir <xref
        linkend="svn.advanced.props.special.mime-type"/></para>
    </note>

    <para>Subversion 1.5 introduit la résolution interactive des
      conflits (décrite dans <xref linkend="svn.tour.cycle.resolve"/>)
       et l'une des options proposées à l'utilisateur est de lancer
       un outil de fusion externe. Si cette action est choisie,
       Subversion consultera l'option <literal>merge-tool-cmd</literal>
       de la zone de configuration des exécutables, susceptible de
       contenir le nom d'un outil externe de fusion et, s'il en
       trouve un, lancera cet outil avec les fichiers appropriés en
       paramètres. Il y a deux différences notables avec l'outil de
       comparaison de trois fichiers. D'abord, l'outil de comparaison
       est toujours utilisé pour afficher les différences entre trois
       fichiers alors que l'outil de fusion est employé uniquement
       quand l'application de comparaison a détecté un conflit.
       Ensuite, l'interface est beaucoup plus propre — votre outil de
       fusion a seulement besoin d'accepter comme paramètres en ligne
       de commande les chemins des quatre fichiers suivants&nbsp;: le
       fichier de référence, le <quote>leur</quote> (qui contient
       les modifications en provenance du dépôt), le
       <quote>mien</quote> (qui contient les modifications locales)
       et le fichier dans lequel sera placé le contenu final à
       stocker.</para>

    <!-- =============================================================== -->
    <sect2 id="svn.advanced.externaldifftools.diff">
      <title>Programme externe de comparaison</title>

      <para>Subversion appelle les programmes externes de comparaison
        avec des paramètres compatibles avec la suite d'outils de
        comparaison GNU et s'attend à ce que le programme renvoie un
        code d'erreur signifiant la réussite de la comparaison. Pour
        la plupart des programmes de comparaison alternatifs, seuls
        les sixième et septième arguments, indiquant les chemins vers
        les fichiers à comparer, respectivement placés à gauche et à
        droite, sont intéressants. Notez que Subversion lance le
        programme de comparaison pour chaque fichier concerné par
        l'opération Subversion, ce qui peut vous amener à avoir
        plusieurs instances simultanément si votre programme
        fonctionne de manière asynchrone (ou s'il est placé en
        arrière-plan). Enfin, Subversion s'attend à ce que votre
        programme retourne un code d'erreur de 1 s'il a détecté des
        différences ou 0 sinon. Tout autre code d'erreur est considéré
        comme une erreur fatale
        <footnote>
          <para>Le manuel du diff GNU indique&nbsp;: <quote>Un code de
            retour valant 0 signifie qu'aucune différence n'a été
            trouvée, 1 signifie que des différences sont apparues,
            2 indique une erreur</quote>.</para>
        </footnote>.
        </para>

      <para>L'<xref
        linkend="svn.advanced.externaldifftools.diff.ex-1"/> et
        l' <xref linkend="svn.advanced.externaldifftools.diff.ex-2"/>
        sont des modèles de scripts d'interface pour un outil externe
        de comparaison, respectivement en langage Python et en langage
        de script Windows&nbsp;:</para>

      <example id="svn.advanced.externaldifftools.diff.ex-1">
        <title>interface-diff.py</title>
        <programlisting>
#!/usr/bin/env python
import sys
import os

# Indiquez ici le chemin de votre outil de comparaison favori.
DIFF = "/usr/local/bin/mon-diff-perso"

# Subversion fournit les chemins voulus dans les deux derniers arguments.
GAUCHE = sys.argv[-2]
DROITE = sys.argv[-1]

# Appelons la commande de comparaison (modifiez la ligne suivante
# en accord avec votre programme de comparaison).
cmd = [DIFF, '--left', GAUCHE, '--right', DROITE]
os.execv(cmd[0], cmd)

# Le code d'erreur renvoyé doit être :
# 0 si aucune différence n'est détectée,
# 1 s'il y a des différences.
# Tout autre code est traité comme une erreur fatale.
</programlisting>
      </example>

      <example id="svn.advanced.externaldifftools.diff.ex-2">
        <title>interface-diff.bat</title>
        <programlisting>
@ECHO OFF

REM Indiquez ici le chemin de votre outil de comparaison favori.
SET DIFF="C:\Program Files\Super Progs\Mon Diff Perso.exe"

REM Subversion fournit les chemins voulus dans les deux derniers arguments.
REM Ce sont les paramètres 6 et 7 (sauf si vous utilisez svn diff -x,
REM auquel cas tout est possible).
SET GAUCHE=%6
SET DROITE=%7

REM Appelons la commande de comparaison (modifiez la ligne suivante
REM en accord avec votre programme de comparaison).
%DIFF% --left %GAUCHE% --right %DROITE%

REM Le code d'erreur renvoyé doit être :
REM 0 si aucune différence n'est détectée,
REM 1 s'il y a des différences.
REM Tout autre code est traité comme une erreur fatale.
</programlisting>
      </example>
    </sect2>

    <!-- =============================================================== -->
    <sect2 id="svn.advanced.externaldifftools.diff3">
      <title>Programme externe de comparaison de trois fichiers</title>

      <para>Subversion appelle les programmes externes de fusion
        avec des paramètres compatibles avec l'outil GNU diff3 et
        s'attend à ce que le programme externe retourne un code
        d'erreur correct et que le fichier résultant de l'opération de
        fusion soit envoyé vers la sortie standard (de façon à ce que
        Subversion puisse le rediriger vers le fichier suivi en
        versions approprié). Pour la plupart des programmes de fusion
        alternatifs, seuls les neuvième, dixième et onzième arguments
        (les chemins des fichiers qui contiennent les versions
        <quote>mien</quote>, <quote>original</quote> et
        <quote>leur</quote> respectivement) sont intéressants. Notez
        que puisque Subversion utilise la sortie de votre programme
        de fusion, votre script d'interface ne doit pas se terminer
        avant que la sortie n'ait été fournie à Subversion. Quand il
        se termine, il doit retourner un code d'erreur de 0 si la
        fusion s'est correctement déroulée ou de 1 si des conflits
        non résolus persistent dans la sortie. Tout autre code d'erreur
        est considéré comme une erreur fatale.</para>

      <para>L'<xref
        linkend="svn.advanced.externaldifftools.diff3.ex-1"/> et
        l'<xref linkend="svn.advanced.externaldifftools.diff3.ex-2"/>
        sont des modèles pour des scripts d'interface vers un
        programme externe de fusion en langage Python et script
        Windows respectivement.</para>

      <example id="svn.advanced.externaldifftools.diff3.ex-1">
        <title>interface-diff3.py</title>
        <programlisting>
#!/usr/bin/env python
import sys
import os

# Indiquez ici le chemin de votre outil de fusion favori.
DIFF3 = "/usr/local/bin/mon-outil-de-fusion"

# Subversion fournit les chemins voulus dans les trois derniers arguments.
MIEN  = sys.argv[-3]
VIEUX = sys.argv[-2]
LEUR  = sys.argv[-1]

# Appelons la commande de fusion (modifiez la ligne suivante
# en accord avec votre outil de fusion).
cmd = [DIFF3, '--older', VIEUX, '--mine', MIEN, '--yours', LEUR]
os.execv(cmd[0], cmd)

# Après avoir effectué la fusion, le script doit envoyer le
# contenu du fichier résultant vers la sortie standard (stdout)
# Faites le à votre convenance.
# Le code d'erreur renvoyé doit être :
# 0 si la fusion a bien fonctionné,
# 1 s'il reste des conflits non résolus.
# Tout autre code est traité comme une erreur fatale.

</programlisting>
      </example>

      <example id="svn.advanced.externaldifftools.diff3.ex-2">
        <title>interface-diff3.bat</title>
        <programlisting>
@ECHO OFF

REM Indiquez ici le chemin de votre outil de fusion favori.
SET DIFF3="C:\Program Files\Super Progs\Mon Outil De Fusion.exe"

REM Subversion fournit les chemins voulus dans les trois derniers arguments.
REM Ce sont les paramètres 9, 10 et 11. Mais nous n'avons accès qu'à
REM neuf paramètres en même temps, nous effectuons donc deux décalages
REM pour obtenir les paramètres manquants.
SHIFT
SHIFT
SET MIEN=%7
SET VIEUX=%8
SET LEUR=%9

REM Appelons la commande de fusion (modifiez la ligne suivante
REM en accord avec votre outil de fusion).
%DIFF3% --older %VIEUX% --mine %MIEN% --yours %LEUR%

REM Après avoir effectué la fusion, le script doit envoyer le
REM contenu du fichier résultant vers la sortie standard (stdout)
REM Faites le à votre convenance.
REM Le code d'erreur renvoyé doit être :
REM 0 si la fusion a bien fonctionné,
REM 1 s'il reste des conflits non résolus.
REM Tout autre code est traité comme une erreur fatale.
</programlisting>
      </example>

    </sect2>
  </sect1>

  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <!-- ================================================================= -->
  <sect1 id="svn.customization.summary">
    <title>Résumé</title>

    <para>Quelquefois il n'y a qu'une façon de bien faire les choses,
      quelquefois il en existe plusieurs. Les développeurs de
      Subversion comprennent que bien que le plus souvent son
      comportement est acceptable par la plupart des utilisateurs,
      il y a des fonctionnalités pour lesquelles il n'existe pas de
      consensus. Dans ces situations, Subversion permet à
      l'utilisateur de spécifier le comportement
      qu'<emphasis>il</emphasis> désire voir appliquer.</para>

    <para>Dans ce chapitre, nous avons examiné le système de
      configuration des exécutables de Subversion ainsi que d'autres
      mécanismes permettant de contrôler le comportement de certaines
      actions. Si vous êtes développeur, le prochain chapitre vous
      emmènera un cran plus loin. Il décrit comment vous pouvez
      personnaliser davantage Subversion en écrivant vos propres
      programmes en remplacement des bibliothèques Subversion.</para>

  </sect1>

</chapter>

<!--
local variables:
sgml-parent-document: ("book.xml" "chapter")
end:
-->
